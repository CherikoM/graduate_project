<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.project.dao.AuditorDAO">
    <!--resultMap:处理表和DO对象的属性映射，确保表中的每个字段都有属性可以匹配-->
    <!--id:映射的唯一标识，一般命名为xxxResultMap-->
    <!--type:对应的DO类完整路径-->
    <resultMap id="auditorResultMap" type="com.example.project.dataobject.AuditorDO">
        <!--id:设置数据库主键字段信息-->
        <!--column:表的字段名称-->
        <!--property:对应的DO属性名称-->
        <id column="id" property="id"/>
        <!--result:设置数据库其他字段信息-->
        <result column="user_id" property="userId"/>
        <result column="release_pt" property="releasePt"/>
        <result column="artist_pt" property="artistPt"/>
        <result column="label_pt" property="labelPt"/>
        <result column="style_pt" property="stylePt"/>
        <result column="can_use" property="canUse"/>
        <result column="gmt_created" property="gmtCreated"/>
        <result column="gmt_modified" property="gmtModified"/>
    </resultMap>

    <select id="getAuditorById" resultMap="auditorResultMap">
        <if test="id != null">
            select * from `auditor` where id = #{id}
        </if>
    </select>

    <select id="getAuditorByUserId" resultMap="auditorResultMap">
        <if test="id != null">
            select * from `auditor` where user_id = #{id}
        </if>
    </select>

    <update id="updateAuditPoint" parameterType="java.util.Map">
        <if test="auditorMap!=null and auditorMap.size()>0">
            update `auditor`
            <trim prefix="set" suffixOverrides=",">
                <if test="auditorMap.releases != null and auditorMap.releases.size() > 0">
                    <trim prefix="release_pt = case" suffix="end,">
                        <foreach collection="auditorMap.releases.entrySet()" index="id" item="i">
                            <if test="id != '' and id != null">
                                when id=#{id} then #{i}
                            </if>
                        </foreach>
                        else 0
                    </trim>
                </if>
                <if test="auditorMap.artists != null and auditorMap.artists.size() > 0">
                    <trim prefix="artist_pt = case" suffix="end,">
                        <foreach collection="auditorMap.artists.entrySet()" index="id" item="i">
                            <if test="id != '' and id != null">
                                when id=#{id} then #{i}
                            </if>
                        </foreach>
                        else 0
                    </trim>
                </if>
                <if test="auditorMap.labels != null and auditorMap.labels.size() > 0">
                    <trim prefix="label_pt = case" suffix="end,">
                        <foreach collection="auditorMap.labels.entrySet()" index="id" item="i">
                            <if test="id != '' and id != null">
                                when id=#{id} then #{i}
                            </if>
                        </foreach>
                        else 0
                    </trim>
                </if>
                <if test="auditorMap.styles != null and auditorMap.styles.size() > 0">
                    <trim prefix="style_pt = case" suffix="end,">
                        <foreach collection="auditorMap.styles.entrySet()" index="id" item="i">
                            <if test="id != '' and id != null">
                                when id=#{id} then #{i}
                            </if>
                        </foreach>
                        else 0
                    </trim>
                </if>
            </trim>
            where id in
            <foreach collection="auditorMap.releases.entrySet()" index="id" item="t" separator="," open="(" close=")">
                #{id}
            </foreach>
        </if>
    </update>
</mapper>